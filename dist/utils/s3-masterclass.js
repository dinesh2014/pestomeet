import path from "path";
import multer from "multer";
import multerS3 from "multer-s3";
import { S3, BUCKET, MASTERCLASS_FOLDER } from "./app-constants";
const masterClassUpload = multer({
    storage: multerS3({
        s3: S3,
        acl: 'public-read',
        bucket: BUCKET,
        key: function (req, file, cb) {
            cb(null, MASTERCLASS_FOLDER +
                "/" +
                req.body.resourceName +
                "_" +
                req.body.uploaderId +
                "_" +
                req.body.eventId
                +
                    path.extname(file.originalname));
        },
    }),
    limits: { fileSize: 2000000000 },
    fileFilter: function (req, file, cb) {
        checkFileType(file, cb);
    },
}).single("resource");
function checkFileType(file, cb) {
    // Allowed ext
    const filetypes = /mp4|avi/;
    // Check ext
    const extname = filetypes.test(path.extname(file.originalname).toLowerCase());
    // Check mime
    const mimetype = filetypes.test(file.mimetype);
    if (mimetype && extname) {
        return cb(null, true);
    }
    else {
        cb(null, false);
    }
}
export default masterClassUpload;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiczMtbWFzdGVyY2xhc3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi91dGlscy9zMy1tYXN0ZXJjbGFzcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFFeEIsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sUUFBUSxNQUFNLFdBQVcsQ0FBQztBQUNqQyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBTWpFLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxDQUFDO0lBQy9CLE9BQU8sRUFBRSxRQUFRLENBQUM7UUFDaEIsRUFBRSxFQUFFLEVBQUU7UUFDTixHQUFHLEVBQUUsYUFBYTtRQUNsQixNQUFNLEVBQUUsTUFBTTtRQUNkLEdBQUcsRUFBRSxVQUFVLEdBQVEsRUFBRSxJQUFJLEVBQUUsRUFBb0I7WUFDakQsRUFBRSxDQUNBLElBQUksRUFDSixrQkFBa0I7Z0JBQ2hCLEdBQUc7Z0JBQ0gsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZO2dCQUNyQixHQUFHO2dCQUNILEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVTtnQkFDbkIsR0FBRztnQkFDSCxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU87O29CQUVoQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FDbEMsQ0FBQztRQUNKLENBQUM7S0FDRixDQUFDO0lBQ0YsTUFBTSxFQUFFLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRTtJQUNoQyxVQUFVLEVBQUUsVUFBVSxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQTZCO1FBQzVELGFBQWEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDMUIsQ0FBQztDQUNGLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7QUFFdEIsU0FBUyxhQUFhLENBQUMsSUFBUyxFQUFFLEVBQTZCO0lBQzdELGNBQWM7SUFDZCxNQUFNLFNBQVMsR0FBRyxTQUFTLENBQUM7SUFDNUIsWUFBWTtJQUNaLE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztJQUM5RSxhQUFhO0lBQ2IsTUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDL0MsSUFBSSxRQUFRLElBQUksT0FBTyxFQUFFO1FBQ3ZCLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztLQUN2QjtTQUFNO1FBQ0wsRUFBRSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztLQUNqQjtBQUNILENBQUM7QUFFRCxlQUFlLGlCQUFpQixDQUFDIn0=