import path from "path";
import multer from "multer";
import multerS3 from "multer-s3";
import { S3, PROFILE_FOLDER } from "./app-constants";
const profileImgUpload = multer({
    storage: multerS3({
        s3: S3,
        bucket: "pestomeet-recordings",
        key: function (req, file, cb) {
            cb(null, PROFILE_FOLDER +
                "/" +
                req.params.id +
                path.extname(file.originalname));
        },
    }),
    limits: { fileSize: 2000000 },
    fileFilter: function (req, file, cb) {
        checkFileType(file, cb);
    },
}).single("profileImage");
function checkFileType(file, cb) {
    // Allowed extension
    const filetypes = /jpeg|jpg|png|gif/;
    // Check ext
    const extname = filetypes.test(path.extname(file.originalname).toLowerCase());
    // Check mime
    const mimetype = filetypes.test(file.mimetype);
    if (mimetype && extname) {
        return cb(null, true);
    }
    else {
        cb(null, false);
    }
}
export default profileImgUpload;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiczMtYXZhdGFyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdXRpbHMvczMtYXZhdGFyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUV4QixPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFDNUIsT0FBTyxRQUFRLE1BQU0sV0FBVyxDQUFDO0FBQ2pDLE9BQU8sRUFBRSxFQUFFLEVBQUUsY0FBYyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFNckQsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUM7SUFDOUIsT0FBTyxFQUFFLFFBQVEsQ0FBQztRQUNoQixFQUFFLEVBQUUsRUFBRTtRQUNOLE1BQU0sRUFBRSxzQkFBc0I7UUFDOUIsR0FBRyxFQUFFLFVBQVUsR0FBTyxFQUFFLElBQUksRUFBRSxFQUFvQjtZQUNoRCxFQUFFLENBQ0EsSUFBSSxFQUNKLGNBQWM7Z0JBQ1osR0FBRztnQkFDSCxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ2IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQzVCLENBQUM7UUFDVixDQUFDO0tBQ0YsQ0FBQztJQUNGLE1BQU0sRUFBRSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUU7SUFDN0IsVUFBVSxFQUFFLFVBQVUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUE2QjtRQUM1RCxhQUFhLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzFCLENBQUM7Q0FDRixDQUFDLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBRTFCLFNBQVMsYUFBYSxDQUFDLElBQVMsRUFBRSxFQUE2QjtJQUM3RCxvQkFBb0I7SUFDcEIsTUFBTSxTQUFTLEdBQUcsa0JBQWtCLENBQUM7SUFDckMsWUFBWTtJQUNaLE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztJQUM5RSxhQUFhO0lBQ2IsTUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDL0MsSUFBSSxRQUFRLElBQUksT0FBTyxFQUFFO1FBQ3ZCLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztLQUN2QjtTQUFNO1FBQ0wsRUFBRSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztLQUNqQjtBQUNILENBQUM7QUFFRCxlQUFlLGdCQUFnQixDQUFDIn0=